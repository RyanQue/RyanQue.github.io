<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Customer Review Analysis and Neural Network Modelling - EDA and processing | Chaoran (Ryan) Que </title> <meta name="author" content="Chaoran (Ryan) Que"> <meta name="description" content="Amazon Review Classification"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/weblogo.png?cf4a6f33b4cf731d009704119027958e"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://ryanque.github.io/blog/2022/NLP6850_1/"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Customer Review Analysis and Neural Network Modelling - EDA and processing",
            "description": "Amazon Review Classification",
            "published": "March 05, 2022",
            "authors": [
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Chaoran</span> (Ryan) Que </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Customer Review Analysis and Neural Network Modelling - EDA and processing</h1> <p>Amazon Review Classification</p> </d-title> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div> <a href="#introduction">Introduction</a> </div> <div> <a href="#task-description">Task description</a> </div> <div> <a href="#procedures">Procedures</a> </div> </nav> </d-contents> <h2 id="introduction">Introduction</h2> <p><em>This blog post was initially written in 2022 as a summary of a in-class ML project. <a href="https://www.kaggle.com/competitions/qbus6850-2022s1-assignment/overview" rel="external nofollow noopener" target="_blank">check this link.</a> Several articles shed light upon the structure of the neural network I developed in this project, which gave me a basic idea of how to construct a neural network, as well as the modulized design behind the scene.</em></p> <p>This link contains <a href="https://github.com/RyanQue/backupRepo/tree/43cd3f76ce6272f44021584ecd3737a0fca0f6ee/githubPage/NLP6850" rel="external nofollow noopener" target="_blank">the files of the project</a>.</p> <p>In this blog, natural language processing and neural network are the major 2 parts that would be elaborate on, including several techniques, libraries that are usually would not be used when handling ordinary numerical data.</p> <h2 id="task-description">Task description</h2> <p>Customer review is important for the business to reflect on and improve the products/services. Due to the complex nature of human natural language, manually handing these unstructured data cannot fulfil the current business requirement.</p> <p>Sentiment Analysis can be adopted to categorize and sort the opinions by <em>positive, neutral, negative</em>. (could be more nuanced in the categories) It helps to understand what customers like/dislike about the product/service.</p> <p>In this project, machine learning methods are used to perform sentiment analysis &amp; classification to a dataset which contains Amazon customer reviews on Kindle Book.</p> <blockquote> <p>Dataset link: <a href="http://jmcauley.ucsd.edu/data/amazon/" rel="external nofollow noopener" target="_blank">Amazon review data (ucsd.edu)</a></p> </blockquote> <p>We only use 9000 samples from the dataset, with sensitive information pre-processed - thus only the review text (long text), summary (short text), and the rating (target, numerical, 1 to 5) are used in the modelling.</p> <p><strong>GOAL:</strong> build machine learning models that can predict the rating based on the text data.</p> <p>The metrics used for evaluation is the F1-score (weighted average F1-score of each label as this is a multi-label task)</p> <h2 id="procedures">Procedures</h2> <p>First of all, importing all the libraries, setting random seed, configuration, read data, etc..</p> <details><summary>Click here for codes</summary> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># basic EDA libs
</span><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="n">missingno</span> <span class="k">as</span> <span class="n">msn</span>
<span class="kn">import</span> <span class="n">warnings</span>
<span class="kn">import</span> <span class="n">random</span>
<span class="kn">import</span> <span class="n">math</span>

<span class="c1"># setting
</span><span class="n">warnings</span><span class="p">.</span><span class="nf">filterwarnings</span><span class="p">(</span><span class="sh">'</span><span class="s">ignore</span><span class="sh">'</span><span class="p">)</span>
<span class="n">pd</span><span class="p">.</span><span class="nf">set_option</span><span class="p">(</span><span class="sh">"</span><span class="s">display.max_columns</span><span class="sh">"</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="kn">from</span> <span class="n">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="n">re</span>

<span class="kn">import</span> <span class="n">torch</span>

<span class="c1"># reproducibility (global setting)
</span><span class="n">torch</span><span class="p">.</span><span class="nf">manual_seed</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">seed</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">random</span><span class="p">.</span><span class="nf">seed</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># NLP libs
</span><span class="kn">import</span> <span class="n">pkg_resources</span>
<span class="kn">from</span> <span class="n">symspellpy</span> <span class="kn">import</span> <span class="n">SymSpell</span><span class="p">,</span> <span class="n">Verbosity</span>

<span class="kn">from</span> <span class="n">nltk.tokenize</span> <span class="kn">import</span> <span class="n">word_tokenize</span>
<span class="kn">from</span> <span class="n">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">import</span> <span class="n">string</span>
<span class="kn">import</span> <span class="n">contractions</span>
<span class="kn">import</span> <span class="n">html</span>
<span class="kn">import</span> <span class="n">spacy</span>

<span class="c1"># run line below if the lib is never used before
# spacy.cli.download("en_core_web_sm")
</span><span class="n">spacyNLP</span> <span class="o">=</span> <span class="n">spacy</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">en_core_web_sm</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># read data
</span><span class="n">originData</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">"</span><span class="s">train.csv</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># create a deep copy - make sure the original dataset is not changed.
</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">originData</span><span class="p">.</span><span class="nf">copy</span><span class="p">(</span><span class="n">deep</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</code></pre></div></div> </details> <h3 id="i-eda">I EDA</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dataset</span><span class="p">.</span><span class="nf">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div> <table> <thead> <tr> <th style="text-align: left"> </th> <th style="text-align: left">rating</th> <th style="text-align: left">reviewText</th> <th>summary</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">1306</td> <td style="text-align: left">4</td> <td style="text-align: left">I really enjoyed this book because it ended on…</td> <td>Surviving The Game</td> </tr> <tr> <td style="text-align: left">4120</td> <td style="text-align: left">5</td> <td style="text-align: left">This is a very dark and twisted tale of the da…</td> <td>Very twisted</td> </tr> <tr> <td style="text-align: left">4422</td> <td style="text-align: left">1</td> <td style="text-align: left">Thank heavens this was an Amazon freebie when …</td> <td>Failed resurrection.</td> </tr> </tbody> </table> <ul> <li> <code class="language-plaintext highlighter-rouge">rating</code> -numerical, the target</li> <li> <code class="language-plaintext highlighter-rouge">reviewText</code> - longer text review, feature</li> <li> <p><code class="language-plaintext highlighter-rouge">summary</code> - shorter text review, feature</p> </li> <li>check missing value <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="n">msn</span><span class="p">.</span><span class="nf">bar</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">lightsteelblue</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div> </div> <p><strong>INSIGHTS:</strong> no missing value</p> </li> </ul> <h4 id="target---rating">target - <code class="language-plaintext highlighter-rouge">rating</code> </h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="p">.</span><span class="nf">histplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="sh">'</span><span class="s">rating</span><span class="sh">'</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
</code></pre></div></div> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/NLP6850/targetBar-480.webp 480w,/assets/img/posts/NLP6850/targetBar-800.webp 800w,/assets/img/posts/NLP6850/targetBar-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/NLP6850/targetBar.png" class="img-fluid rounded mx-auto d-block z-depth-1" width="100%" height="auto" style=" max-width: 60%; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p><strong>INSIGHTS:</strong></p> <ul> <li>This is a multi-classfication problem</li> <li><strong>Classes have rank relationship from 1 to 5, but the number does not imply the ratio.</strong></li> <li>slightly unbalanced dataset - 4 and 5 have more samples and 3 has less.</li> </ul> <h4 id="reviewtext"><code class="language-plaintext highlighter-rouge">reviewText</code></h4> <ul> <li>A histogram for counting the characters in the <code class="language-plaintext highlighter-rouge">reviewText</code> </li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dataset</span><span class="p">[</span><span class="sh">'</span><span class="s">reviewTextCharCount</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="sh">'</span><span class="s">reviewText</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">histplot</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="sh">'</span><span class="s">reviewTextCharCount</span><span class="sh">'</span><span class="p">],</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
</code></pre></div></div> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/NLP6850/reviewTextBar-480.webp 480w,/assets/img/posts/NLP6850/reviewTextBar-800.webp 800w,/assets/img/posts/NLP6850/reviewTextBar-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/NLP6850/reviewTextBar.png" class="img-fluid rounded mx-auto d-block z-depth-1" width="100%" height="auto" style=" max-width: 60%; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p><strong>INSIGHTS:</strong></p> <p>The graph shows that there are some reviews that write a really long message while some just have a few words. Apparently right skewed.</p> <h4 id="summary"><code class="language-plaintext highlighter-rouge">summary</code></h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dataset</span><span class="p">[</span><span class="sh">'</span><span class="s">summaryCharCount</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">histplot</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="sh">'</span><span class="s">summaryCharCount</span><span class="sh">'</span><span class="p">],</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
</code></pre></div></div> <p>The image shows that <code class="language-plaintext highlighter-rouge">summary</code> has much shorter length but it is also right skewed.</p> <h4 id="relation-between-the-target-and-a-feature">Relation between the target and a feature</h4> <p>The most accessible numerical feature is the length of review, plotting it against the rating to see if there is any difference.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="sh">'</span><span class="s">rating</span><span class="sh">'</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">summaryCharCount</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">showfliers</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span> <span class="n">ax1</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">boxplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="sh">'</span><span class="s">rating</span><span class="sh">'</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="sh">'</span><span class="s">reviewTextCharCount</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">showfliers</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/NLP6850/featureXTarget-480.webp 480w,/assets/img/posts/NLP6850/featureXTarget-800.webp 800w,/assets/img/posts/NLP6850/featureXTarget-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/NLP6850/featureXTarget.png" class="img-fluid rounded mx-auto d-block z-depth-1" width="100%" height="auto" style=" max-width: 80%; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p><strong>INSIGHTS:</strong></p> <p>As is shown in the boxplot(outlier excluded), there is little difference in the length of reviews and summaries between different ratings.</p> <p>Review text length is less on rating 1 and 5, with other ratings have longer text, the difference is not abvious though.</p> <h4 id="relation-between-features">Relation between features</h4> <p>See if there is any similarity of words between two features. And plotting it against the target variable.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># define the overlap similarity score
# we use overlap instead of other methods 
# because the difference in length between two columns are quite big
</span><span class="k">def</span> <span class="nf">overlapSim</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nf">set</span><span class="p">(</span><span class="n">str1</span><span class="p">.</span><span class="nf">lower</span><span class="p">().</span><span class="nf">split</span><span class="p">())</span> 
    <span class="n">b</span> <span class="o">=</span> <span class="nf">set</span><span class="p">(</span><span class="n">str2</span><span class="p">.</span><span class="nf">lower</span><span class="p">().</span><span class="nf">split</span><span class="p">())</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="nf">intersection</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">float</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">/</span> <span class="nf">min</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="nf">len</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>

<span class="n">overlapScoreResult</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">.</span><span class="nf">iterrows</span><span class="p">():</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">row</span><span class="p">.</span><span class="n">reviewText</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">row</span><span class="p">.</span><span class="n">summary</span>
    <span class="n">overlapScore</span> <span class="o">=</span> <span class="nf">overlapSim</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
    <span class="n">overlapScoreResult</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">overlapScore</span><span class="p">)</span>

<span class="n">dataset</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
              <span class="n">column</span> <span class="o">=</span> <span class="sh">'</span><span class="s">overlapScore</span><span class="sh">'</span><span class="p">,</span>
              <span class="n">value</span> <span class="o">=</span> <span class="n">overlapScoreResult</span><span class="p">)</span>

<span class="c1">#plotting the overlapscore
</span><span class="n">sns</span><span class="p">.</span><span class="nf">histplot</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="sh">'</span><span class="s">overlapScore</span><span class="sh">'</span><span class="p">],</span><span class="n">bins</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
</code></pre></div></div> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/NLP6850/overlap-480.webp 480w,/assets/img/posts/NLP6850/overlap-800.webp 800w,/assets/img/posts/NLP6850/overlap-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/posts/NLP6850/overlap.png" class="img-fluid rounded mx-auto d-block z-depth-1" width="100%" height="auto" style=" max-width: 80%; " data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>There is a large proportion of reviews that its summary has no <strong>word similarity</strong> with its content.</p> <p>However, this does not necessarily mean they do not have <strong>semantic similarity</strong>, more advanced techniques(using trained model / vectorized representation / after normalization) can be used to analyse the sementical similarity.</p> <p>The reason why similarity is analysed here is that <code class="language-plaintext highlighter-rouge">summary</code> may not provide accurate attitude and will be elaborate on the longer <code class="language-plaintext highlighter-rouge">reviewText</code>.</p> <h3 id="ii-data-pre-processing">II Data Pre-processing</h3> <p>Some of the deeper EDAs is better done after pre-processing because dirty data would influence the accuracy of the analysis.</p> <p>Text is better transformed into numerical representation, in order to be fed to the model. Due to the fact that the Text-to-number is rather a complicated task for computer, cleaning the data is vital to mitigate the information loss/variation.</p> <p>Here is a typical example:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">'good', 'GOOD', 'Goooood', 'best', 'great', 'graet', 'good!'</code> should mean the same thing with only slight difference in terms of <strong>form, puntuation, upper/lower case, typo, etc.</strong>. But the model may consider them as different word if only simple methods is used to transform them.</li> </ul> <p>There are also many methods to tranform the texts into numbers:</p> <ol> <li>Bag of words</li> <li>TF-idf</li> <li>Advanced embedding method (vectorization)</li> </ol> <p><strong>NOTE that some methods may cause data leakage</strong> - methods that involve information in the test/validation set. - We should retrict these methods to be deployed in the training set only.</p> <h4 id="html-entities">html entities</h4> <p>There are html entities in the text, which need to be converted into its readable form.</p> <blockquote> <p><a href="https://www.w3schools.com/html/html_entities.asp" rel="external nofollow noopener" target="_blank">HTML Entities (w3schools.com)</a></p> </blockquote> <p>example: <code class="language-plaintext highlighter-rouge">&amp;#39;</code> -&gt; <code class="language-plaintext highlighter-rouge">'</code></p> <p>A python library <code class="language-plaintext highlighter-rouge">html</code> can deal with such entities</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">htmlEntityTran</span><span class="p">(</span><span class="n">DF</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
        <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="o">=</span> <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">html</span><span class="p">.</span><span class="nf">unescape</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</code></pre></div></div> <h4 id="contraction-expansion">contraction expansion</h4> <p>contraction should be expanded to its full text:</p> <p>example: <code class="language-plaintext highlighter-rouge">I'm</code> -&gt; <code class="language-plaintext highlighter-rouge">I am</code></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">contractionExpansion</span><span class="p">(</span><span class="n">DF</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
        <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="o">=</span> <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">contractions</span><span class="p">.</span><span class="nf">fix</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</code></pre></div></div> <h4 id="punctuation-processing">punctuation processing</h4> <p>There are a lot of emoticons and misuse of punctuations in the text because the book reviews text is from online source without careful check.</p> <p>In the process below, we define all the possible emoticons(not comprehensive) that can be identified and process them with its meaning.</p> <p><em>The emoticon lists was copied from a repository in Github</em></p> <details><summary>Click here for codes</summary> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">punctuationProcess</span><span class="p">(</span><span class="n">DF</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
        <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="o">=</span> <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nf">puncFix</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        
<span class="n">smileEmo</span> <span class="o">=</span> <span class="sa">r</span><span class="sh">"""</span><span class="s">:-) :) :-] :] :-&gt; :&gt; 8-) 8) :-} :} :o) :c) :^) =] =) ^_^ ^^ :</span><span class="sh">'</span><span class="s">) :3 :-3 =3 x3 X3 (: (-: ))</span><span class="sh">"""</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s"> </span><span class="sh">"</span><span class="p">)</span> 

<span class="n">laughEmo</span> <span class="o">=</span>  <span class="sa">r</span><span class="sh">"""</span><span class="s">:-D :D 8-D 8D =D =3 B^D c: x-D xD X-D XD C:]</span><span class="sh">"""</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s"> </span><span class="sh">"</span><span class="p">)</span>

<span class="n">winkEmo</span> <span class="o">=</span> <span class="sa">r</span><span class="sh">"""</span><span class="s">;-) ;) *-) *) ;-] ;] ;^) ;&gt; :-, ;D ;3</span><span class="sh">"""</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s"> </span><span class="sh">"</span><span class="p">)</span>

<span class="n">sadEmo</span> <span class="o">=</span> <span class="sa">r</span><span class="sh">"""</span><span class="s">:-( :( :-c :c :-&lt; :&lt; :-[ :[ :-|| &gt;:[ :{ :@ :( ;( :</span><span class="sh">'</span><span class="s">-( :</span><span class="sh">'</span><span class="s">( :=( :$ ): </span><span class="sh">"""</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s"> </span><span class="sh">"</span><span class="p">)</span>

<span class="n">skepEmo</span> <span class="o">=</span><span class="sa">r</span><span class="sh">"""</span><span class="s">
:-/ 
:/ 
:-. 
&gt;:\
&gt;:/
=/
=\
:L
=L
:S
:-|
:|
-_-
</span><span class="sh">"""</span><span class="p">.</span><span class="nf">split</span><span class="p">()</span>
           
<span class="n">stunEmo</span> <span class="o">=</span> <span class="sa">r</span><span class="sh">"""</span><span class="s">:-O :O :-o :o :-0 8‑0 &gt;:O =O =o =0 O_O o_o O-O o-o O_o o_O</span><span class="sh">"""</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s"> </span><span class="sh">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">puncFix</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">emoticon</span> <span class="ow">in</span> <span class="n">smileEmo</span><span class="p">:</span>        
        <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">emoticon</span><span class="p">,</span> <span class="sh">'</span><span class="s">smileface</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">emoticon</span> <span class="ow">in</span> <span class="n">laughEmo</span><span class="p">:</span>        
        <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">emoticon</span><span class="p">,</span> <span class="sh">'</span><span class="s">laughface</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">emoticon</span> <span class="ow">in</span> <span class="n">winkEmo</span><span class="p">:</span>        
        <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">emoticon</span><span class="p">,</span> <span class="sh">'</span><span class="s">winkface</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">emoticon</span> <span class="ow">in</span> <span class="n">sadEmo</span><span class="p">:</span>        
        <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">emoticon</span><span class="p">,</span> <span class="sh">'</span><span class="s">sadface</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">emoticon</span> <span class="ow">in</span> <span class="n">skepEmo</span><span class="p">:</span>        
        <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">emoticon</span><span class="p">,</span> <span class="sh">'</span><span class="s">skepticalface</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">emoticon</span> <span class="ow">in</span> <span class="n">stunEmo</span><span class="p">:</span>        
        <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">emoticon</span><span class="p">,</span> <span class="sh">'</span><span class="s">stunnedface</span><span class="sh">'</span><span class="p">)</span>
<span class="c1"># ↑ emoticons processed
# ↓ special punctuations processed
</span>    <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">$$</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">ss</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">$</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">money</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">w/</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">with</span><span class="sh">'</span><span class="p">)</span>
<span class="c1"># the 2 steps below are adding spaces between punctuation and character.
</span>    <span class="n">row</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="sa">r</span><span class="sh">"""</span><span class="s">(?&lt;=[,.!</span><span class="sh">'"</span><span class="s">;:()*?/-])(?=[a-zA-Z])</span><span class="sh">"""</span><span class="p">,</span> <span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="sa">r</span><span class="sh">"""</span><span class="s">(?&lt;=[a-zA-Z])(?=[,.!</span><span class="sh">'"</span><span class="s">;:()*?/-])</span><span class="sh">"""</span><span class="p">,</span> <span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>

<span class="c1"># render the repeating punctuations consistent
</span>    <span class="n">row</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="sa">r</span><span class="sh">"</span><span class="s">[...][.]+</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">...</span><span class="sh">'</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="sa">r</span><span class="sh">"</span><span class="s">[--][-]+</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">--</span><span class="sh">'</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>

<span class="c1"># adding spaces before and after **
</span>    <span class="n">row</span> <span class="p">:</span> <span class="n">row</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">**</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s"> ** </span><span class="sh">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">row</span>
</code></pre></div></div> </details> <p>This process could be improved with much more careful look into the data samples and find relevant improvement potentials.</p> <p><strong>A tool to check the special punctuations are provided later in this section</strong></p> <h4 id="lower-case">lower case</h4> <p>This process turn any upper case into lower case.</p> <p>This process should be improved, there are several concerns regarding:</p> <ul> <li>upper case for intensify the emotions expressed</li> <li>upper case for abbreviation</li> </ul> <p>If simply transform all the characteristics into lower case, there could be some important information being dumped.</p> <p>In this project, we still define the function and use it with certain order (after some other procedures like counting uppercase amount) to avoid information loss.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># lower case
# A =&gt; a
</span><span class="k">def</span> <span class="nf">lowercaseCountTranformer</span><span class="p">(</span><span class="n">DF</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    This function transform all the characters into lower case,
    And store the number of upper case
    </span><span class="sh">"""</span>
    <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
        <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="o">+</span><span class="sh">'</span><span class="s">UpperCount</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">if</span> <span class="n">c</span><span class="p">.</span><span class="nf">isupper</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="o">=</span> <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="nf">lower</span><span class="p">())</span>
</code></pre></div></div> <h4 id="lemmatization-and-stemming">Lemmatization and Stemming</h4> <blockquote> <p><a href="https://nlp.stanford.edu/IR-book/html/htmledition/stemming-and-lemmatization-1.html" rel="external nofollow noopener" target="_blank">Stemming and lemmatization (stanford.edu)</a> This website introduce the basic idea of lemmatization and stemming.</p> </blockquote> <p>In short word, Lemmatization transform the word into its original form precisely, considering the spelling, part of speech, comparative form, etc. - needs more computation power but provide better results in general. Stemming is relatively simple - chops off the ends of words to collapse the derivationally related words.</p> <p><strong>EXAMPLE:</strong></p> <p><code class="language-plaintext highlighter-rouge">saw</code> – lemma –&gt; <code class="language-plaintext highlighter-rouge">see </code> – little information loss</p> <p><code class="language-plaintext highlighter-rouge">saw</code> –stem–&gt; <code class="language-plaintext highlighter-rouge">s</code> – large information loss</p> <p>There are still more considerations in choosing these two methods to clean the data, which is <strong>task-specific</strong>.</p> <p>In this project, due to the small size of samples, we choose lemmatization which is provided by <code class="language-plaintext highlighter-rouge">spaCy</code> (standfordNLP library is too slow, I tried)</p> <blockquote> <p><a href="https://spacy.io/" rel="external nofollow noopener" target="_blank">spaCy · Industrial-strength Natural Language Processing in Python</a></p> </blockquote> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># lemmatization and stemming
# turn the word back to its original form
</span>
<span class="c1"># tokenization
# turning a sentense into a list of words
</span>
<span class="k">def</span> <span class="nf">LemmatizationTransform</span><span class="p">(</span><span class="n">DF</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Lemma</span><span class="sh">"</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    spacy is used but only the tokenization and lemmatization pipeline component is used.
    NLTK(also standfordNLP) has some similar functions but lack the precision and speed

    tokenization is also done by this step together in SpaCy
    </span><span class="sh">"""</span>
    <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="sh">"</span><span class="s">Lemma</span><span class="sh">"</span><span class="p">:</span>
            <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="o">+</span><span class="sh">'</span><span class="s">tokenized</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="p">[</span><span class="n">token</span><span class="p">.</span><span class="n">lemma_</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="nf">spacyNLP</span><span class="p">(</span><span class="n">row</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="o">+</span><span class="sh">'</span><span class="s">tokenized</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="p">[</span><span class="n">token</span><span class="p">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="nf">spacyNLP</span><span class="p">(</span><span class="n">row</span><span class="p">)])</span>
</code></pre></div></div> <h4 id="stop-word-removal">Stop word removal</h4> <p>stop word removal process is also <strong>task-specific</strong>. The goal of this project is predicting the sentiment which has negative and positive directions - Some stop words would indicate a turning point in the meaning that would possibly impact the sentiment. We customize the stop word list to fit our purpose of the project.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># check the stopword removal wordlist
</span><span class="nf">print</span><span class="p">(</span><span class="n">stopwords</span><span class="p">.</span><span class="nf">words</span><span class="p">(</span><span class="sh">'</span><span class="s">english</span><span class="sh">'</span><span class="p">))</span>
</code></pre></div></div> <details><summary>Click here for codes</summary> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">origin</span> <span class="o">=</span> <span class="nf">set</span><span class="p">(</span><span class="n">stopwords</span><span class="p">.</span><span class="nf">words</span><span class="p">(</span><span class="sh">'</span><span class="s">english</span><span class="sh">'</span><span class="p">))</span>

<span class="n">wanted</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">what</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">but</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">against</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">down</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">up</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">on</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">off</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">over</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">under</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">out</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">same</span><span class="sh">'</span>
                <span class="sh">'</span><span class="s">again</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">further</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">why</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">what</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">how</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">all</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">any</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">with</span><span class="sh">'</span>
                <span class="sh">'</span><span class="s">few</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">more</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">most</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">other</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">no</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">nor</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">not</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">only</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">than</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">too</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">very</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">just</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">should</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ain</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">aren</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">aren</span><span class="sh">'</span><span class="s">t</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">couldn</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">couldn</span><span class="sh">'</span><span class="s">t</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">didn</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">didn</span><span class="sh">'</span><span class="s">t</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">doesn</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">doesn</span><span class="sh">'</span><span class="s">t</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">hadn</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">hadn</span><span class="sh">'</span><span class="s">t</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">hasn</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">hasn</span><span class="sh">'</span><span class="s">t</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">haven</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">haven</span><span class="sh">'</span><span class="s">t</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">isn</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">isn</span><span class="sh">'</span><span class="s">t</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">ma</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">mightn</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">mightn</span><span class="sh">'</span><span class="s">t</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">mustn</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">mustn</span><span class="sh">'</span><span class="s">t</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">needn</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">needn</span><span class="sh">'</span><span class="s">t</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">shan</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">shan</span><span class="sh">'</span><span class="s">t</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">shouldn</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">shouldn</span><span class="sh">'</span><span class="s">t</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">wasn</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">wasn</span><span class="sh">'</span><span class="s">t</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">weren</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">weren</span><span class="sh">'</span><span class="s">t</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">won</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">won</span><span class="sh">'</span><span class="s">t</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">wouldn</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">wouldn</span><span class="sh">'</span><span class="s">t</span><span class="sh">"</span><span class="p">}</span>

<span class="n">unwanted</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">the</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">I</span><span class="sh">'</span><span class="p">,</span><span class="sh">"'</span><span class="s">s</span><span class="sh">"</span><span class="p">}</span>

<span class="n">StopWordCustom_Deep</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">origin</span> <span class="o">-</span> <span class="n">wanted</span> <span class="o">|</span> <span class="n">unwanted</span><span class="p">)</span>

<span class="n">StopWordCustom_Shallow</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">it</span><span class="sh">'</span><span class="s">s</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">their</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">re</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">she</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ours</span><span class="sh">'</span><span class="p">,</span> 
                          <span class="sh">'</span><span class="s">it</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ve</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">you</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">y</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">o</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">themselves</span><span class="sh">'</span><span class="p">,</span>
                          <span class="sh">'</span><span class="s">your</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">yours</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">m</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">you</span><span class="sh">'</span><span class="s">d</span><span class="sh">"</span><span class="p">,</span>
                          <span class="sh">"</span><span class="s">you</span><span class="sh">'</span><span class="s">re</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">and</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">its</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">you</span><span class="sh">'</span><span class="s">ve</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">that</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ourselves</span><span class="sh">'</span><span class="p">,</span>
                          <span class="sh">'</span><span class="s">himself</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">this</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">been</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">you</span><span class="sh">'</span><span class="s">ll</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">an</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">my</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">me</span><span class="sh">'</span><span class="p">,</span>
                          <span class="sh">'</span><span class="s">myself</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">these</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">which</span><span class="sh">'</span><span class="p">,</span>
                          <span class="sh">'</span><span class="s">he</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">his</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">I</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">them</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">the</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"'</span><span class="s">s</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">yourselves</span><span class="sh">'</span><span class="p">,</span> 
                          <span class="sh">'</span><span class="s">our</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">s</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">yourself</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">theirs</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">herself</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">they</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">she</span><span class="sh">'</span><span class="s">s</span><span class="sh">"</span><span class="p">,</span>
                          <span class="sh">'</span><span class="s">hers</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">we</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">those</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">him</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">that</span><span class="sh">'</span><span class="s">ll</span><span class="sh">"</span><span class="p">,</span> <span class="sh">'</span><span class="s">i</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">her</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">itself</span><span class="sh">'</span><span class="p">]</span>

<span class="c1"># stopword removal function
</span><span class="k">def</span> <span class="nf">stopWordRemove</span><span class="p">(</span><span class="n">DF</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">deep</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">deep</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="o">=</span> <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">alist</span><span class="p">:</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">alist</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">StopWordCustom_Deep</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="o">=</span> <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">alist</span><span class="p">:</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">alist</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">StopWordCustom_Shallow</span><span class="p">])</span>

</code></pre></div></div> </details> <h4 id="punctuation-removal">Punctuation removal</h4> <p>‘…’ and ‘!’ and ‘?’ would contain some information about the sentiment, other punctuations are relatively less informative.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># punctuation
# '...' and '!' and '?' would contain some information about the sentiment
</span><span class="n">punctList</span> <span class="o">=</span> <span class="nf">set</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">punctuation</span><span class="p">)</span>
<span class="n">puncwanted</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">!</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">?</span><span class="sh">'</span><span class="p">}</span>
<span class="n">puncunwanted</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">}</span>
<span class="n">punctList</span> <span class="o">=</span> <span class="n">punctList</span> <span class="o">-</span> <span class="n">puncwanted</span> <span class="o">|</span> <span class="n">puncunwanted</span> 

<span class="k">def</span> <span class="nf">punctRemover</span><span class="p">(</span><span class="n">DF</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
        <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="o">=</span> <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">alist</span><span class="p">:</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">alist</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">punctList</span><span class="p">])</span>
</code></pre></div></div> <h4 id="spell-mistakes-fix">Spell mistakes fix</h4> <p>It is noticed that in the dataset there are several misspells which affects the data quality. The library <code class="language-plaintext highlighter-rouge">symspell</code> do the job of fixing the spell mistakes. The algorithm is based on edit distance, and a special searching method to accelerate the process.</p> <blockquote> <p>The github page: <a href="https://github.com/wolfgarbe/SymSpell" rel="external nofollow noopener" target="_blank">wolfgarbe/SymSpell: SymSpell: 1 million times faster spelling correction &amp; fuzzy search through Symmetric Delete spelling correction algorithm (github.com)</a></p> <table> <tbody> <tr> <td>The algorithm: [1000x Faster Spelling Correction algorithm</td> <td>SeekStorm](https://seekstorm.com/blog/1000x-spelling-correction/)</td> </tr> </tbody> </table> </blockquote> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># the library also works on the punctuations, which we do not hope to happen.
# Therefore, we create a exception list where things in the list would not change
</span><span class="n">punctuationException</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">?</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">!</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">...</span><span class="sh">'</span><span class="p">}</span>
<span class="n">others</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">eh</span><span class="sh">'</span><span class="p">}</span>
<span class="n">symspellException</span> <span class="o">=</span> <span class="n">punctuationException</span> <span class="o">|</span> <span class="n">others</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sym_spell</span> <span class="o">=</span> <span class="nc">SymSpell</span><span class="p">(</span><span class="n">max_dictionary_edit_distance</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">prefix_length</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">dictionary_path</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="p">.</span><span class="nf">resource_filename</span><span class="p">(</span>
    <span class="sh">"</span><span class="s">symspellpy</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">frequency_dictionary_en_82_765.txt</span><span class="sh">"</span>
<span class="p">)</span>
<span class="c1"># term_index is the column of the term and count_index is the
# column of the term frequency
</span><span class="n">sym_spell</span><span class="p">.</span><span class="nf">load_dictionary</span><span class="p">(</span><span class="n">dictionary_path</span><span class="p">,</span> <span class="n">term_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">count_index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">spellcheck</span><span class="p">(</span><span class="n">tokens</span><span class="p">):</span>
    <span class="n">checkedtokens</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
        <span class="nf">if </span><span class="p">(</span><span class="n">token</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">symspellException</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">token</span><span class="p">.</span><span class="nf">isnumeric</span><span class="p">()):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">checkedtokens</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">sym_spell</span><span class="p">.</span><span class="nf">lookup</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">Verbosity</span><span class="p">.</span><span class="n">CLOSEST</span><span class="p">,</span> <span class="n">max_edit_distance</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="n">term</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">checkedtokens</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">checkedtokens</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">checkedtokens</span>

<span class="k">def</span> <span class="nf">spellCheckReplace</span><span class="p">(</span><span class="n">DF</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">acol</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
        <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="p">]</span> <span class="o">=</span> <span class="n">DF</span><span class="p">[</span><span class="n">acol</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="n">spellcheck</span><span class="p">)</span>
</code></pre></div></div> <h4 id="pre-process-pipeline">pre-process pipeline</h4> <p>We define all the cleaning processes as functions instead of directly doing it - so that we can <strong>create different levels of pre-process to fit certain structure of models.</strong></p> <p><strong>EXAMPLE:</strong></p> <ul> <li> <p>LSTM and CNN do consider the context of certain word - where some stop words would be kept.</p> </li> <li> <p>If BOW or TF-IDF is used for text representation - the order of the words is not considered - pre-process can be deep, removing all the noisy texts.</p> </li> </ul> <details><summary>Click here for codes</summary> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Workflow of deep preprocess
</span><span class="k">def</span> <span class="nf">DeepPreprocess</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="nf">htmlEntityTran</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="sh">'</span><span class="s">reviewText</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="p">])</span> <span class="c1"># &amp;#34; =&gt; "
</span>    <span class="nf">contractionExpansion</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="sh">'</span><span class="s">reviewText</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="p">])</span> <span class="c1"># I'm =&gt; I am
</span>    <span class="nf">punctuationProcess</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="sh">'</span><span class="s">reviewText</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="p">])</span> <span class="c1"># add space before puncs; emoticon; normalize
</span>    <span class="nf">lowercaseCountTranformer</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="sh">'</span><span class="s">reviewText</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="p">])</span> <span class="c1"># A =&gt; a ; add count column
</span>    <span class="nc">LemmatizationTransform</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="sh">'</span><span class="s">reviewText</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="p">])</span> <span class="c1"># smiled =&gt; smile; tokenized
</span>    <span class="nf">stopWordRemove</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="sh">'</span><span class="s">reviewTexttokenized</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">summarytokenized</span><span class="sh">'</span><span class="p">])</span> <span class="c1"># delete "I"
</span>    <span class="nf">punctRemover</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="sh">'</span><span class="s">reviewTexttokenized</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">summarytokenized</span><span class="sh">'</span><span class="p">])</span> <span class="c1"># delete meaningless punctuation
</span>    <span class="nf">spellCheckReplace</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="sh">'</span><span class="s">reviewTexttokenized</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">summarytokenized</span><span class="sh">'</span><span class="p">])</span> <span class="c1"># graet =&gt; great
</span>    
<span class="nc">DeepPreprocess</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

<span class="c1">#DeepPreprocess(dataset)
#subData = pd.read_csv('test.csv')
#DeepPreprocess(subData)
#subData.to_csv('preprocessedtest_deep.csv')
#dataset.to_csv('preprocessedtrain_deep.csv')
</span>
<span class="c1"># shallow preprocessing (for neural networks that can learn grammar)
</span><span class="k">def</span> <span class="nf">ShallowPreprocess</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="nf">htmlEntityTran</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="sh">'</span><span class="s">reviewText</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="p">])</span> <span class="c1"># &amp;#34; =&gt; "
</span>    <span class="nf">contractionExpansion</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="sh">'</span><span class="s">reviewText</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="p">])</span> <span class="c1"># I'm =&gt; I am
</span>    <span class="nf">punctuationProcess</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="sh">'</span><span class="s">reviewText</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="p">])</span> <span class="c1"># add space before puncs; emoticon; normalize
</span>    <span class="nf">lowercaseCountTranformer</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="sh">'</span><span class="s">reviewText</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="p">])</span> <span class="c1"># A =&gt; a ; add count column
</span>    <span class="nc">LemmatizationTransform</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="sh">'</span><span class="s">reviewText</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="p">],</span> <span class="n">mode</span> <span class="o">=</span> <span class="sh">"</span><span class="s">shallow</span><span class="sh">"</span><span class="p">)</span> <span class="c1"># only tokenized
</span>    <span class="nf">stopWordRemove</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="sh">'</span><span class="s">reviewTexttokenized</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">summarytokenized</span><span class="sh">'</span><span class="p">],</span> <span class="n">deep</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="c1"># delete "I"
</span>    <span class="nf">punctRemover</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="sh">'</span><span class="s">reviewTexttokenized</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">summarytokenized</span><span class="sh">'</span><span class="p">])</span> <span class="c1"># delete meaningless punctuation
</span>
<span class="c1"># run this to do shallow preprocess 
# keep the proposition 
# avoid using misspelling correction - 
# it may do wrongly and convert useful information to something else
</span>
<span class="c1">#subData = pd.read_csv('test.csv')
#ShallowPreprocess(dataset)
#ShallowPreprocess(subData)
</span>
<span class="n">subData</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">preprocessedtest_deep.csv</span><span class="sh">'</span><span class="p">)</span>
<span class="n">dataset</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">preprocessedtrain_deep.csv</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> </details> <h4 id="data-quality-checker">data quality checker</h4> <p>This is used for comparing between the original text and the modified/cleaned text.</p> <p>Keep iterating the process to improve.</p> <details><summary>Click here for codes</summary> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">9000</span><span class="p">)</span>
<span class="c1">#a = 8983
</span><span class="nf">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="sh">'</span><span class="s">reviewTexttokenized</span><span class="sh">'</span><span class="p">].</span><span class="n">iloc</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">==============================</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="sh">'</span><span class="s">summarytokenized</span><span class="sh">'</span><span class="p">].</span><span class="n">iloc</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">==============================</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="sh">'</span><span class="s">reviewText</span><span class="sh">'</span><span class="p">].</span><span class="n">iloc</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">==============================</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="p">].</span><span class="n">iloc</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">******************************</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">originData</span><span class="p">[</span><span class="sh">'</span><span class="s">reviewText</span><span class="sh">'</span><span class="p">].</span><span class="n">iloc</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">==============================</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">originData</span><span class="p">[</span><span class="sh">'</span><span class="s">summary</span><span class="sh">'</span><span class="p">].</span><span class="n">iloc</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
</code></pre></div></div> <ul> <li>counting the length of different features</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="n">counter</span> <span class="o">=</span> <span class="nc">Counter</span><span class="p">()</span>

<span class="n">MaxLengthReview</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">MaxLengthSummary</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">[</span><span class="sh">'</span><span class="s">reviewTexttokenized</span><span class="sh">'</span><span class="p">]:</span>
    <span class="n">counter</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">MaxLengthReview</span><span class="p">:</span>
        <span class="n">MaxLengthReview</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">[</span><span class="sh">'</span><span class="s">summarytokenized</span><span class="sh">'</span><span class="p">]:</span>
    <span class="n">counter</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">MaxLengthSummary</span><span class="p">:</span>
        <span class="n">MaxLengthSummary</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">MaxLengthReview</span><span class="sh">'</span><span class="p">,</span> <span class="n">MaxLengthReview</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">MaxLengthSummary</span><span class="sh">'</span><span class="p">,</span><span class="n">MaxLengthSummary</span><span class="p">)</span>
</code></pre></div></div> <ul> <li>Check the punctuation to seek for improvement.</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">akey</span> <span class="ow">in</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">counter</span><span class="p">.</span><span class="nf">keys</span><span class="p">()):</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">akey</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">string</span><span class="p">.</span><span class="n">punctuation</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="c1">#        if counter[akey]&gt;=2:
</span>        <span class="nf">print</span><span class="p">(</span><span class="n">akey</span><span class="p">,</span> <span class="sh">'</span><span class="s">|===&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="n">counter</span><span class="p">[</span><span class="n">akey</span><span class="p">])</span> 
</code></pre></div></div> </details> <p>After data is pre-processed, a cleansed dataset is generated and stored in .csv format. and modelling would be done in seperated files.</p> <h3 id="iii-before-modelling">III Before Modelling</h3> <p>loading data etc..</p> <details><summary>Click here for codes</summary> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Text is pre-processed
</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">preprocessedtrain_deep.csv</span><span class="sh">'</span><span class="p">,</span>
                      <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="n">converters</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">reviewTexttokenized</span><span class="sh">'</span><span class="p">:</span> <span class="nb">eval</span><span class="p">,</span>
                                    <span class="sh">'</span><span class="s">summarytokenized</span><span class="sh">'</span><span class="p">:</span> <span class="nb">eval</span><span class="p">}</span>
                     <span class="p">)</span>

<span class="c1"># add more 2 features - the percentage of capital letters
</span><span class="n">dataset</span><span class="p">[</span><span class="sh">'</span><span class="s">reviewCapitalPer</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="sh">'</span><span class="s">reviewTextUpperCount</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="n">dataset</span><span class="p">[</span><span class="sh">'</span><span class="s">reviewTextCharCount</span><span class="sh">'</span><span class="p">]</span>
<span class="n">dataset</span><span class="p">[</span><span class="sh">'</span><span class="s">summaryCapitalPer</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="sh">'</span><span class="s">summaryUpperCount</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="n">dataset</span><span class="p">[</span><span class="sh">'</span><span class="s">summaryCharCount</span><span class="sh">'</span><span class="p">]</span>
</code></pre></div></div> </details> <h4 id="text-data-representation">Text Data Representation</h4> <p>Very common methods to represent text data include <strong>BoW</strong> (Bag of Words), <strong>TF-iDF</strong> (Term Frequency-Inverse Document Frequency).</p> <p>TF-iDF considers whether the word is important, while BoW only counts the occurrences. - TF-iDF usually work better in practice.</p> <blockquote> <p><a href="https://medium.com/@jyotikhetan2/a-practical-guide-to-tf-idf-and-term-frequency-in-text-analysis-b332c0405639" rel="external nofollow noopener" target="_blank">A Medium blog explaining TF-IDF</a></p> </blockquote> <ul> <li>Data leakage problem</li> </ul> <p>TF-iDF should be done after the splitting of train/valid/test data - otherwise there would be data leakage risk.</p> <p><strong>Why?</strong></p> \[TF(term\ frequency) = \frac {count\ of\ term\ in\ document }{number\ of\ words\ in\ document}\] \[iDF(inverse\ Document\ Frequency) =log( \frac{number\ of\ documents}{number\ of\ documents\ that\ have\ the\ term})\] <p>If test/valid data is not splitted in advance, TF-iDF calculation would contain information of the unseen data.</p> <p>To prevent data leakage - we use pipeline to make sure the TF-iDF calculation is after splitting.</p> <h4 id="stratified-split">Stratified Split</h4> <p>The imbalanced dataset pose a challenge for the model because most algorithms hold the assumption that each class has an equal number of examples.</p> <blockquote> <p><a href="https://machinelearningmastery.com/what-is-imbalanced-classification/" rel="external nofollow noopener" target="_blank">A Gentle Introduction to Imbalanced Classification (machinelearningmastery.com)</a></p> </blockquote> <p>In this project, imbalance is not severe, but for accuracy of the model, we use stratified split - making sure that the proportion of each class in test/valid/train dataset would be the same.</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/"></d-bibliography> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Chaoran (Ryan) Que. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: February 26, 2024. </div> </footer> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>